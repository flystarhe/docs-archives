title: 新闻订阅推荐算法(EdgeRank)
date: 2015-05-18
tags: [Rank,EdgeRank]
---
EdgeRank算法的引入在脸书世界里已经引起了一些骚动。最开始的变化是用户News feeds的默认设置变成了“我互动最多的朋友和页面”，这是脸书第一步举措，以着手过滤掉对每一个用户没有吸引力的内容。这实际上意味着，如果一个品牌页面的粉丝不与品牌经常性地互动，他们就不会看到这个页面发布的品牌页面信息(wall post)。

<!--more-->
EdgeRank是Facebook对新鲜事(Feeds)排序的新算法，用于区别默认的按时间逆序的timeline。不像PageRank还有很多论文或学术界的资料，目前没有什么官方资料讨论EdgeRank，搜到的资料大部分来自在线广告代理公司或优化团队。

## EdgeRank
EdgeRank用于当某个用户查看他的新鲜事时，决定这些新鲜事先后顺序的一个排序算法。你得先了解一些定义，每个出现在你news feed里的内容被称作object，当有人与你news feed里面的object互动行为被称作一个edge，这些互动行为包括赞一下、评论、圈照片。算法核心是每个事件对这个用户而言的权重E，其计算公式是E` = u*w*d`，其中：

- u，事件生产者和阅读者之间的亲密度
    + 亲密度主要指的是互动情况，互动越频繁亲密度越高
    + 互动可以是单向的，比如A经常关注B，而B不怎么关注A，那u(a,b)和u(b, a)的权重不一样
- w，边权重(主要是事件的类型)
    + 显然评论的权重比赞一下的权重要高，点击跟其他事件的关系说明：
    + Avg Clicks Per Like: 3.103
    + Avg Clicks Per Comment: 14.678
    + Avg Clicks Per Impression: 0.005
- d，时间衰减因子
    + 比较少见到讨论时间衰减因子怎么做的，猜测是类log变化
    + 如果将EdgeRank公式只保留d，则EdgeRank退化到经典timeline模式

## GraphRank
EdgeRank用于描述某事件对某观察者而言的重要性，考虑了事件生产者和观察者的亲密度、事件类型以及时间衰减因子。而对于一些还不是好友关系的事件需要push时(比如一些公共信息或来自好友的分享)，还要考虑分享是否需要被关注，则引入GraphRank的概念。

GraphRank跟EdgeRank的区别主要是在`u*w*d`之外，再加了一层事件生产者和观察者之间的相关度，变为`u*w*d*r`。

>其中相关度r是一个和亲密度无关的影响因子，亲密度更多受最近的互动频度影响，相关度则是一个时间无关的特征，描述两者相似度。

## EdgeRank的意义
Timeline模式对大多数人来说其实已经够用，而EdgeRank排序后的Feeds并不能有一个很好的效果评判标准。看用户在Feeds模式下是否有比Timeline模式更好的体验怎么看？很难。

从大部分广告相关的资料来看，受EdgeRank影响最大的应该是那些企业用户。以前企业用户可以花比较低的价格建立一个公共主页(Page)，然后以比常规广告便宜得多的方式获得大量粉丝(Fans/Follower)，对于这些成为粉丝用户，企业的新广告就可以以几乎免费的价格推送到这些人的timeline中。显然这样的结果不是Facebook乐于见到的，你们都可以不花钱做广告了，那我们喝西北风么？而且Facebook也想通过EdgeRank让企业知道，他的多少粉丝是僵尸粉，都是没意义的。

回到EdgeRank的定义，相比较timeline模式的区别就在多出来那两个参数u和w。w没什么好说的，可以认为就是简单加权，或者考虑事件对用户的重要度。u才是EdgeRank的核心所在。如果a跟b互动少，那么u(a,b)值变低，则导致b发布的东西在a那的排名就会很低，如果把a看成一个粉丝，而b是某企业的主页，则这个主页发布的消息在这个粉丝这可能就完全看不见了。

所以，为了保持现有粉丝的有效性，企业必须经常发布一些互动活动来保持现有粉丝的活跃度，否则千辛万苦弄来的粉丝都没意义了。而同时为了把那些已经僵尸掉的粉丝挽救回来，以及扩展新粉丝，企业还是需要投放大量广告，这样Facebook的广告业务就不会因为公共主页粉丝数变多而衰落，整个公司也就能一直维持很好的盈利状况了。(最后这段有点阴谋论和职业敏感在里面)

## 你觉得应如何对知乎的新鲜事排序？
具体问题描述：知乎用户刘看山，他关注了100个人，30个专栏，10个话题。在他打开知乎的一瞬间，将有100个最新动态等着他，你要怎么给这100个新鲜事排序？当然，作为知乎官方，你掌握着几乎所有知乎用户的信息，包括刘看山的。他经常给谁点赞，经常关注哪个话题下面的问题，这些你都知道。哦，对了，你只有50毫秒时间。超过50毫秒刘看山就会不耐烦了。你该怎么办？

**0 这些新鲜事对用户而言质量各有高低**

如果你让刘看山自己看一遍这100个新鲜事，他大概能说出自己更喜欢哪个，更不喜欢哪个。比如，他更喜欢张佳玮的答案，张公子的回答他基本都会点开看。他不太喜欢抖机灵的回答，即使赞同数很高他也只是扫一眼就过去。我们要做的，就是用模型化的语言描述这件事。

**1 确定一个变量作为优化目标**

这个变量，要能反映新鲜事的质量。一组常用的变量就是互动数：点开，赞同，感谢。好的新鲜事应该能吸引到更多的互动，这样的新鲜事也更应该排在前面。

当然另一方面，用什么变量来定义成功其实不是一个简单的问题。Twitter的创始人之一Evan Williams就曾发文警告用单一变量定义成功的危险性。我们在这里也可以考虑其他信号，比如被很多用户点选“没有帮助”的新鲜事很可能质量不高，又或者用户花了很长时间在上面的新鲜事很可能质量不错。于是，“没有帮助”数和阅读时长也可以成为我们的优化目标之一。

**2 预测用户在哪个新鲜事上更可能触发我们的目标变量**

或者说，在哪个新鲜事上刘看山更可能点开/赞同/收藏/分享/长时间阅读，在哪个新鲜事上更可能选不再显示/没有帮助，前者要排高点，后者排低点。

这就是机器学习(Machine Learning)派上用场的时候了。具体用什么算法是个开放性问题。可以是Logistic Regression，可以是SVM，还可以是别的，各有各的特点。(真要是做ML的面试题，这里会和选手展开讨论一下)算法不重要，那什么重要？Feature。这就是知乎数据库里的那些数据的作用了。刘看山之前赞过张公子几次，这个回答被总共看了几次并赞了几次，这些都是feature。从历史看未来。Feature是强大的模型的关键。

**3 故事还没有结束**

学术上，这个模型已经差不多成型了。然而在实际应用中，很多问题还应付不了。比如说：

- 刘看山看到张公子赞了别人的一个回答，大概读了下，没意思，就过去了。后来刘看山所关注的张小北也赞了这个回答。这时候这个新鲜事要怎么排序？
- 刘看山出远门一周没上知乎，回来一上知乎1000个新鲜事可以排序。好不容易排完了，刘看山看了10个就关浏览器了。一个小时之后刘看山再上知乎的时候，之前剩下的990个新鲜事你要怎么办？

你会发现，这个问题与其说是算法，不如说是涉及产品本身的决策。所以说，好的ranking engineer都是半个PM(还有半个Data Scientist和半个Growth Hacker)。

## 参考资料：
- [EdgeRank对品牌意味着什么](http://qing.blog.sina.com.cn/2282115205/88065085330003gq.html)
- [乱弹EdgeRank](http://www.yewen.us/blog/2011/12/intro-edgerank/)
- [你觉得应如何对知乎的新鲜事排序？](http://www.zhihu.com/question/20319819)
- [EdgeRank，让内容显示在news feed里的秘密](http://yaosocial.com/edgerank-the-secret-sauce-that-makes-facebooks-news-feed-tick/2011/04/14/)
- [微博推荐算法简述](http://www.wbrecom.com/?p=80)